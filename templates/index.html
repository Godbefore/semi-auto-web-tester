<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>åŠè‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œå·¥å…·</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
      .form-inline-wrap {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }
      .form-inline-wrap form {
        margin-bottom: 0;
      }
      .code-block, .error-block {
        white-space: pre-wrap;
        word-break: break-all;
      }
    </style>
</head>
<body class="p-4 bg-light" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
<div class="card mb-4">
  <div class="card-body">
    <h1 class="card-title">
      <a href="/" title="è¿”å›é¦–é¡µ" style="text-decoration: none; color: inherit;">
        ğŸ§ª åŠè‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œå·¥å…·
      </a>
    </h1>
  </div>
</div>

    <!-- åŸºæœ¬æ§åˆ¶ -->
    <div class="card mb-4 p-3">
      <h5 class="mb-3">åŸºç¡€æ“ä½œ</h5>
      <div class="form-inline-wrap">
        <form action="/start" method="post">
            <button class="btn btn-primary">åˆå§‹åŒ–æµè§ˆå™¨</button>
        </form>

        <form action="/refresh" method="post">
            <button class="btn btn-secondary">åˆ·æ–°é¡µé¢</button>
        </form>

        <form action="/load" method="post" class="d-flex">
            <input name="url" placeholder="è¾“å…¥URL" class="form-control me-2" style="width:250px;">
            <button class="btn btn-success">åŠ è½½é¡µé¢</button>
        </form>


            <button id="btnScreenshot" class="btn btn-info">æˆªå›¾</button>

      </div>
    </div>

    <div class="card mb-4 p-3">
      <h5>åŠ¨æ€ä¸šåŠ¡æ–¹æ³•</h5>
      {% for category, funcs in grouped_methods.items() %}
        <h6 class="mt-3">{{ category }}</h6>
        <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
          {% for func in funcs %}
              <form action="/run_func/{{ func.func_name }}" method="post">
                  <button class="btn btn-outline-dark">{{ func.display }}</button>
              </form>
          {% endfor %}
        </div>
      {% endfor %}
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="card mb-4 p-3">
          <form action="/nl_to_code" method="post">
              <label class="form-label">è‡ªç„¶è¯­è¨€ â†’ PlaywrightæŒ‡ä»¤</label>
              <textarea name="nl_text" rows="4" class="form-control mb-2" placeholder="ä¾‹å¦‚ï¼šæ‰“å¼€ç™¾åº¦å¹¶æœç´¢MCP"></textarea>
              <button class="btn btn-success">æ‰§è¡Œ</button>
          </form>
          {% if generated_code %}
          <div class="mt-3 p-3 border bg-light code-block">
              <strong>ç”Ÿæˆä»£ç ï¼š</strong>
              <div>{{ generated_code }}</div>
          </div>
          {% endif %}
        </div>
      </div>

      <div class="col-md-6">
        <div class="card mb-4 p-3">
          <form action="/execute_code" method="post">
              <label class="form-label">æ‰§è¡Œä»»æ„ Python</label>
                <textarea name="code" rows="4" class="form-control" placeholder="è¾“å…¥ Python ä»£ç ï¼Œå¦‚&#10;page.goto(&quot;https://www.baidu.com&quot;)&#10;page.fill(&#39;input[name=&quot;wd&quot;]&#39;, &quot;mcp&quot;)&#10;page.click(&#39;input[type=&quot;submit&quot;]&#39;)"></textarea>
              <button class="btn btn-warning mt-2">æ‰§è¡Œ</button>
          </form>
          {% if code_output %}
          <div class="mt-3 p-3 border bg-light code-block">{{ code_output }}</div>
          {% endif %}
          {% if error_message %}
          <div class="mt-3 p-3 border bg-danger text-white error-block">
              <!--strong>æ‰§è¡Œå‡ºé”™ï¼š</strong-->
              {{ error_message }}
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="card mb-4 p-3">
      <h5 class="mb-3">é¡µé¢æˆªå›¾</h5>
      <div id="screenshotContainer">
          {% if screenshot_data %}
          <img src="data:image/png;base64,{{ screenshot_data }}" class="img-fluid border" />
          {% endif %}
      </div>
    </div>
</body>
</html>
    <script>
    document.getElementById('btnScreenshot').addEventListener('click', function() {
        fetch('/screenshot', { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            if(data.success){
                // è¯·æ±‚æˆåŠŸï¼Œåˆ·æ–°å›¾ç‰‡ï¼Œé¿å…ç¼“å­˜ï¼ŒåŠ éšæœºå‚æ•°
                const container = document.getElementById('screenshotContainer');
                container.innerHTML = `<img src="data:image/png;base64,${data.image}" style="max-width:100%; border:1px solid #ccc;" />`;
            } else if(data.error){
                alert('æˆªå›¾å¤±è´¥: ' + data.error);
            }
        }).catch(e => alert('æˆªå›¾è¯·æ±‚å¤±è´¥: ' + e));
    });
    </script>